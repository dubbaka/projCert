---

- name: deploy docker container.
  hosts: "server{{ buildNum }}"
  gather_facts: false

  tasks:
    - name: create a host folder.
      become: yes
      file:
        name: /opt/share/nginx/html
        state: directory
        owner: www-data
        group: www-data

    - name: Copy website content
      become: yes
      copy:
        src: /opt/edureka/website
        dest: /opt/share/nginx/html
        owner: www-data
        group: www-data

    - name: stop running docker container
      command: "docker stop nginxphp"
      ignore_errors: yes

    - name: delete simple docker container
      command: "docker rm nginxphp"
      ignore_errors: yes

    - name: build site by running ansible in a docker container
      command: "docker run -d -p 8095:8080 -it -v /opt/share/nginx/html/website:/usr/share/nginx/html --name nginxphp dubbaka/nginx-php"
